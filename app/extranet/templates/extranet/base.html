{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Extranet ICTGROUP - Plateforme collaborative pour la gestion des cong√©s, t√©l√©travail et ressources internes">
    <meta name="author" content="ICTGROUP">
    <title>{% block title %}Extranet ICTGROUP{% endblock %}</title>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="{% static 'img/logo_ictgroup.png' %}" as="image">
    
    <!-- Tailwind CSS loaded first -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#004080',
                        secondary: '#0090FF',
                        success: '#10B981',
                        dark: '#1F2937'
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif']
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-in-out',
                        'slide-up': 'slideUp 0.4s ease-out',
                        'slide-down': 'slideDown 0.3s ease-out'
                    }
                }
            }
        }
    </script>
    
    <!-- Critical CSS optimized -->
    <style>
        /* Performance optimized critical CSS */
        html { scroll-behavior: smooth; }
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            margin: 0;
            padding: 0;
            color: #1f2937;
            /* Prevent layout shift */
            min-height: 100vh;
        }
        
        /* Header optimized styles */
        header {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%) !important;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(30, 64, 175, 0.15);
            position: sticky;
            top: 0;
            z-index: 1000;
            /* Ensure header is always visible */
            display: block !important;
            visibility: visible !important;
        }
        
        .logo-ictgroup {
            height: 2.5rem !important;
            width: auto;
            filter: brightness(1.1) drop-shadow(0 2px 8px #0ea5e9) !important;
            border-radius: 0.5rem;
            transition: transform 0.2s ease !important;
        }
        .logo-ictgroup:hover {
            transform: scale(1.05) !important;
        }
        
        /* Navigation optimized */
        header nav a {
            color: #ffffff !important;
            transition: color 0.2s ease;
            text-decoration: none;
        }
        header nav a:hover {
            color: #fbbf24 !important;
        }
        
        header h1 a {
            color: #ffffff !important;
            transition: color 0.2s ease;
        }
        header h1 a:hover {
            color: #fbbf24 !important;
        }
        
        /* Button styles */
        header form button {
            color: #374151 !important;
            background-color: #ffffff;
            transition: all 0.2s ease;
        }
        header form button:hover {
            color: #ffffff !important;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        /* Layout optimization */
        main {
            min-height: calc(100vh - 200px);
            will-change: contents;
        }
        
        /* Mobile menu fixed */
        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: flex !important;
            }
            
            .desktop-nav {
                display: none !important;
            }
            
            main {
                min-height: calc(100vh - 150px);
                padding: 1rem !important;
            }
        }
        
        @media (min-width: 769px) {
            .mobile-menu-toggle {
                display: none !important;
            }
            
            #mobile-menu {
                display: none !important;
            }
            
            .desktop-nav {
                display: flex !important;
            }
        }
        
        /* Animations optimized */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Force menu visibility fixes */
        .mobile-hidden {
            display: none !important;
        }
        
        .mobile-visible {
            display: block !important;
            animation: slideDown 0.3s ease-out;
        }
        
        /* Performance optimization */
        * {
            box-sizing: border-box;
        }
        
        img {
            loading: lazy;
        }
        
        /* Prevent flash of unstyled content */
        .loading {
            opacity: 0;
        }
        
        .loaded {
            opacity: 1;
            transition: opacity 0.3s ease;
        }
    </style>
    
    <!-- Fonts loaded asynchronously -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS loaded synchronously -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#004080',
                        secondary: '#0090FF',
                        success: '#10B981',
                        dark: '#1F2937'
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif']
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-in-out',
                        'slide-up': 'slideUp 0.8s ease-out'
                    }
                }
            }
        }
    </script>
    
    <!-- Custom CSS loaded immediately after Tailwind -->
        <!-- Custom CSS loaded immediately after Tailwind -->
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'css/mobile.css' %}">
    
    <!-- Non-critical CSS loaded asynchronously -->
    <style id="non-critical-styles">
        /* Dropdown and menu enhancements */
        .dropdown-menu {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        footer {
            background: linear-gradient(135deg, #004080 0%, #0090FF 100%);
        }
        
        /* Enhanced sub-menus */
        nav[aria-label="Menu principal"] .relative.group {
            position: relative;
        }
        nav[aria-label="Menu principal"] .relative.group ul {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.75rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            min-width: 220px;
            z-index: 1000;
            margin-top: 0.5rem;
        }
        nav[aria-label="Menu principal"] .relative.group:hover ul,
        nav[aria-label="Menu principal"] .relative.group:focus-within ul {
            display: block;
        }
        nav[aria-label="Menu principal"] .relative.group ul li {
            width: 100%;
        }
        nav[aria-label="Menu principal"] .relative.group ul a {
            display: block;
            padding: 0.875rem 1.25rem;
            color: #374151 !important;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(229, 231, 235, 0.3);
            text-decoration: none;
        }
        nav[aria-label="Menu principal"] .relative.group ul a:last-child {
            border-bottom: none;
        }
        nav[aria-label="Menu principal"] .relative.group ul a:hover {
            background: linear-gradient(135deg, #004080 0%, #0090FF 100%) !important;
            color: white !important;
            transform: translateX(5px);
        }
        nav[aria-label="Menu principal"] .relative.group ul:hover {
            display: block;
        }
        
        /* Navigation mobile */
        @media (max-width: 768px) {
            header {
                padding: 1rem !important; /* R√©duit le padding sur mobile */
            }
            
            header .container {
                flex-direction: row; /* Garde le logo et menu toggle sur la m√™me ligne */
                flex-wrap: wrap;
                gap: 0.75rem;
                align-items: center;
            }
            
            /* Logo et titre plus compacts */
            .logo-ictgroup {
                height: 2rem !important; /* Logo plus petit sur mobile */
            }
            
            header h1 {
                font-size: 1.25rem !important; /* Titre plus petit */
                line-height: 1.5;
            }
            
            /* Navigation mobile */
            #main-nav {
                width: 100%;
                order: 3; /* Place la nav en bas */
                position: relative;
                z-index: 1000;
            }
            
            #main-nav.mobile-hidden {
                display: none !important;
            }
            
            #main-nav.mobile-visible {
                display: block !important;
                background: rgba(30, 64, 175, 0.95) !important;
                backdrop-filter: blur(10px);
                border-radius: 0.75rem;
                margin-top: 1rem;
                padding: 1rem;
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
                border: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            #main-nav.mobile-visible > ul {
                display: flex !important;
                flex-direction: column;
                align-items: stretch;
                gap: 0.5rem;
                width: 100%;
                padding: 0;
                margin: 0;
            }
            
            /* Override default hidden class on mobile */
            #main-nav ul {
                display: flex !important;
            }
            
            nav[aria-label="Menu principal"] li {
                width: 100%;
                position: relative;
            }
            
            nav[aria-label="Menu principal"] > ul > li > a {
                font-size: 1rem !important;
                font-weight: 500;
                padding: 0.75rem 1rem;
                display: flex;
                align-items: center;
                justify-content: space-between;
                width: 100%;
                color: #ffffff !important;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 0.5rem;
                border: 1px solid rgba(255, 255, 255, 0.1);
                transition: all 0.3s ease;
            }
            
            nav[aria-label="Menu principal"] > ul > li > a:hover,
            nav[aria-label="Menu principal"] > ul > li > a:focus {
                background: rgba(255, 255, 255, 0.2) !important;
                transform: translateX(4px);
                border-color: rgba(255, 255, 255, 0.3);
            }
            
            /* Sous-menus mobiles */
            nav[aria-label="Menu principal"] .submenu-mobile {
                display: none;
                flex-direction: column;
                gap: 0.25rem;
                margin-top: 0.5rem;
                padding: 0.5rem;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 0.5rem;
                border: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            nav[aria-label="Menu principal"] .submenu-mobile.show {
                display: flex !important;
            }
            
            nav[aria-label="Menu principal"] .submenu-mobile a {
                font-size: 0.875rem !important;
                padding: 0.5rem 0.75rem !important;
                color: rgba(255, 255, 255, 0.9) !important;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 0.375rem;
                border: 1px solid transparent;
                transition: all 0.2s ease;
                display: block !important;
                width: 100% !important;
                text-decoration: none;
            }
            
            nav[aria-label="Menu principal"] .submenu-mobile a:hover,
            nav[aria-label="Menu principal"] .submenu-mobile a:focus {
                background: rgba(255, 255, 255, 0.15) !important;
                border-color: rgba(255, 255, 255, 0.2);
                color: #ffffff !important;
            }
            
            /* Badges plus petits sur mobile */
            .animate-pulse {
                font-size: 0.625rem !important;
                padding: 0.125rem 0.375rem !important;
                min-width: 1rem;
                height: 1rem;
            }
            
            /* Conteneur logo + titre */
            header .flex.items-center.space-x-4 {
                space-x: 0.5rem;
                flex: 1; /* Prend l'espace disponible */
            }
            
            /* Menu toggle button */
            #mobile-menu-toggle {
                order: 2;
                flex-shrink: 0;
                background: rgba(255, 255, 255, 0.1) !important;
                border: 1px solid rgba(255, 255, 255, 0.2);
                backdrop-filter: blur(10px);
            }
            
            #mobile-menu-toggle:hover {
                background: rgba(255, 255, 255, 0.2) !important;
                border-color: rgba(255, 255, 255, 0.3);
                transform: scale(1.05);
            }
            
            /* Animation des chevrons */
            .chevron-icon {
                transition: transform 0.3s ease;
            }
            
            /* Badges en mobile */
            .animate-pulse {
                font-size: 0.625rem !important;
                padding: 0.125rem 0.375rem !important;
                min-width: 1rem;
                height: 1rem;
            }
        }
        
        /* Pour les tr√®s petits √©crans */
        @media (max-width: 480px) {
            header {
                padding: 0.75rem !important;
            }
            
            header .container {
                gap: 0.5rem;
            }
            
            .logo-ictgroup {
                height: 1.75rem !important;
            }
            
            header h1 {
                font-size: 1.125rem !important;
            }
            
            nav[aria-label="Menu principal"] a {
                font-size: 0.8rem !important;
                padding: 0.375rem 0.5rem;
            }
        }
        
        /* Accessibility improvements */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen flex flex-col font-inter" role="document">
    <!-- Header with semantic structure -->
    <header class="text-white shadow-2xl sticky top-0 z-50 min-h-[4rem] flex items-center" role="banner">
        <div class="container mx-auto px-4 py-3 w-full">
            <div class="flex justify-between items-center w-full">
                <!-- Logo et titre -->
                <div class="flex items-center space-x-3 flex-1">
                    <img src="{% static 'img/logo_ictgroup.png' %}" 
                         alt="Logo ICT Group" 
                         class="logo-ictgroup transition-transform duration-300 hover:scale-105"
                         width="40" 
                         height="40" />
                    <h1 class="text-xl md:text-2xl font-bold">
                        <a href="{% url 'extranet:home' %}" 
                           class="hover:text-secondary transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white focus:ring-opacity-50 rounded-md"
                           aria-label="Retour au dashboard">ICTGROUP</a>
                    </h1>
                </div>
                
                <!-- Navigation desktop (cach√©e sur mobile) -->
                <nav class="hidden md:flex" aria-label="Menu principal">
                    <ul class="flex space-x-6 items-center">
                        <li>
                            <a href="{% url 'extranet:home' %}" 
                               class="hover:text-secondary font-medium rounded-md transition-all duration-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white focus:ring-opacity-50"
                               role="menuitem">Dashboard</a>
                        </li>
                        
                        {% if user.is_authenticated and user.is_superuser or user.is_authenticated and user.profile and user.profile.role == 'admin' %}
                        <li class="relative group">
                            <a href="#" 
                               class="hover:text-secondary font-medium rounded-md flex items-center transition-all duration-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white focus:ring-opacity-50"
                               role="button"
                               aria-expanded="false"
                               aria-haspopup="true">Admin
                                <svg class="ml-1 w-4 h-4 transition-transform duration-300 group-hover:rotate-180" 
                                     fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
                                     aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                </svg>
                            </a>
                            <ul class="absolute left-0 mt-2 w-56 bg-white text-gray-800 rounded-xl shadow-2xl border border-gray-200 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform group-hover:translate-y-0 translate-y-2"
                                role="menu">
                                <li><a href="{% url 'extranet:user_admin' %}" 
                                       class="block px-4 py-3 hover:bg-gray-100 rounded-t-xl transition-colors duration-200 focus:outline-none focus:bg-gray-100"
                                       role="menuitem">Utilisateurs</a></li>
                                <li><a href="{% url 'extranet:admin_leaves' %}" 
                                       class="block px-4 py-3 hover:bg-gray-100 transition-colors duration-200 focus:outline-none focus:bg-gray-100"
                                       role="menuitem">Cong√©s (admin)</a></li>
                                <li><a href="{% url 'extranet:admin_teleworks' %}" 
                                       class="block px-4 py-3 hover:bg-gray-100 rounded-b-xl transition-colors duration-200 focus:outline-none focus:bg-gray-100"
                                       role="menuitem">T√©l√©travail (admin)</a></li>
                            </ul>
                        </li>
                        {% endif %}
                        
                        <li>
                            <a href="{% url 'extranet:validation' %}" 
                               class="hover:text-secondary font-medium rounded-md flex items-center gap-1 transition-all duration-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white focus:ring-opacity-50"
                               role="menuitem">
                                Validation
                                {% if user.is_authenticated and user.profile.role in 'manager rh admin' %}
                                    {% if leave_validation_count or telework_validation_count %}
                                        <span class="inline-flex items-center justify-center bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded-full animate-pulse ml-1 min-w-[1.25rem]"
                                              aria-label="{{ leave_validation_count|add:telework_validation_count }} demandes en attente">
                                            {{ leave_validation_count|add:telework_validation_count }}
                                        </span>
                                    {% endif %}
                                {% endif %}
                            </a>
                        </li>
                        
                        <li class="relative group">
                            <a href="#" 
                               class="hover:text-secondary font-medium rounded-md flex items-center transition-all duration-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white focus:ring-opacity-50"
                               role="button"
                               aria-expanded="false"
                               aria-haspopup="true">Cong√©s
                                {% if user.is_authenticated and user.profile.role in 'manager rh admin' and leave_validation_count %}
                                    <span class="inline-flex items-center justify-center bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded-full animate-pulse ml-1 min-w-[1.25rem]"
                                          aria-label="{{ leave_validation_count }} demandes de cong√©s en attente">
                                        {{ leave_validation_count }}
                                    </span>
                                {% endif %}
                                <svg class="ml-1 w-4 h-4 transition-transform duration-300 group-hover:rotate-180" 
                                     fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
                                     aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                </svg>
                            </a>
                            <ul class="absolute left-0 mt-2 w-56 bg-white text-gray-800 rounded-xl shadow-2xl border border-gray-200 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform group-hover:translate-y-0 translate-y-2"
                                role="menu">
                                <li><a href="{% url 'extranet:new_leave_request' %}" 
                                       class="block px-4 py-3 hover:bg-gray-100 rounded-t-xl transition-colors duration-200 focus:outline-none focus:bg-gray-100"
                                       role="menuitem">Nouvelle demande</a></li>
                                <li><a href="{% url 'extranet:leave_list' %}" 
                                       class="block px-4 py-3 hover:bg-gray-100 transition-colors duration-200 focus:outline-none focus:bg-gray-100"
                                       role="menuitem">Mes demandes</a></li>
                                <li><a href="{% url 'extranet:monthly_leave_report' %}" 
                                       class="block px-4 py-3 hover:bg-gray-100 rounded-b-xl transition-colors duration-200 focus:outline-none focus:bg-gray-100"
                                       role="menuitem">Rapport mensuel</a></li>
                            </ul>
                        </li>
                        
                        <li class="relative group">
                            <a href="#" 
                               class="hover:text-secondary font-medium rounded-md flex items-center transition-all duration-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white focus:ring-opacity-50"
                               role="button"
                               aria-expanded="false"
                               aria-haspopup="true">T√©l√©travail
                                {% if user.is_authenticated and user.profile.role in 'manager rh admin' and telework_validation_count %}
                                    <span class="inline-flex items-center justify-center bg-orange-500 text-white text-xs font-bold px-2 py-0.5 rounded-full animate-pulse ml-1 min-w-[1.25rem]"
                                          aria-label="{{ telework_validation_count }} demandes de t√©l√©travail en attente">
                                    </span>
                                {% endif %}
                                <svg class="ml-1 w-4 h-4 transition-transform duration-300 group-hover:rotate-180" 
                                     fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
                                     aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                </svg>
                            </a>
                            <ul class="absolute left-0 mt-2 w-56 bg-white text-gray-800 rounded-xl shadow-2xl border border-gray-200 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform group-hover:translate-y-0 translate-y-2"
                                role="menu">
                                <li><a href="{% url 'extranet:new_telework_request' %}" 
                                       class="block px-4 py-3 hover:bg-gray-100 rounded-t-xl transition-colors duration-200 focus:outline-none focus:bg-gray-100"
                                       role="menuitem">Nouvelle demande</a></li>
                                <li><a href="{% url 'extranet:telework_list' %}" 
                                       class="block px-4 py-3 hover:bg-gray-100 transition-colors duration-200 focus:outline-none focus:bg-gray-100"
                                       role="menuitem">Mes demandes</a></li>
                                <li><a href="{% url 'extranet:overtime_list' %}" 
                                       class="block px-4 py-3 hover:bg-gray-100 rounded-b-xl transition-colors duration-200 focus:outline-none focus:bg-gray-100"
                                       role="menuitem">‚è∞ Heures suppl√©mentaires</a></li>
                            </ul>
                        </li>
                        
                        {% if user.is_authenticated and user.profile.site|lower == 'france' %}
                        <li class="relative group">
                            <a href="#" 
                               class="hover:text-secondary font-medium rounded-md flex items-center transition-all duration-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white focus:ring-opacity-50"
                               role="button"
                               aria-expanded="false"
                               aria-haspopup="true">Magasin
                                <svg class="ml-1 w-4 h-4 transition-transform duration-300 group-hover:rotate-180" 
                                     fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
                                     aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                </svg>
                            </a>
                            <ul class="absolute left-0 mt-2 w-56 bg-white text-gray-800 rounded-xl shadow-2xl border border-gray-200 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform group-hover:translate-y-0 translate-y-2"
                                role="menu">
                                <li><a href="{% url 'extranet:stock' %}" 
                                       class="block px-4 py-3 hover:bg-gray-100 rounded-t-xl transition-colors duration-200 focus:outline-none focus:bg-gray-100"
                                       role="menuitem">Stock</a></li>
                                <li><a href="{% url 'extranet:entry_exit' %}" 
                                       class="block px-4 py-3 hover:bg-gray-100 transition-colors duration-200 focus:outline-none focus:bg-gray-100"
                                       role="menuitem">Entr√©e - Sortie</a></li>
                                <li><a href="{% url 'extranet:movements' %}" 
                                       class="block px-4 py-3 hover:bg-gray-100 rounded-b-xl transition-colors duration-200 focus:outline-none focus:bg-gray-100"
                                       role="menuitem">Mouvements</a></li>
                            </ul>
                        </li>
                        {% endif %}
                        
                        <li>
                            <a href="{% url 'extranet:presence_calendar' %}" 
                               class="hover:text-secondary font-medium rounded-md transition-all duration-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white focus:ring-opacity-50"
                               role="menuitem">Calendrier</a>
                        </li>
                        
                        {% if user.is_authenticated %}
                            <li class="relative group">
                                <a href="#" 
                                   class="hover:text-secondary font-medium rounded-md flex items-center transition-all duration-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white focus:ring-opacity-50"
                                   role="button"
                                   aria-expanded="false"
                                   aria-haspopup="true">{{ user.username }}
                                    <svg class="ml-1 w-4 h-4 transition-transform duration-300 group-hover:rotate-180" 
                                         fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
                                         aria-hidden="true">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                    </svg>
                                </a>
                                <ul class="absolute right-0 mt-2 w-56 bg-white text-gray-800 rounded-xl shadow-2xl border border-gray-200 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform group-hover:translate-y-0 translate-y-2"
                                    role="menu">
                                    <li>
                                        <a href="{% url 'extranet:account_settings' %}" 
                                           class="block px-4 py-3 hover:bg-gray-100 rounded-t-xl transition-colors duration-200 focus:outline-none focus:bg-gray-100"
                                           role="menuitem">
                                            <svg class="inline w-4 h-4 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                            </svg>
                                            Mon profil
                                        </a>
                                    </li>
                                    <li>
                                        <a href="{% url 'extranet:document_list' %}" 
                                           class="block px-4 py-3 hover:bg-gray-100 transition-colors duration-200 focus:outline-none focus:bg-gray-100"
                                           role="menuitem">
                                            <svg class="inline w-4 h-4 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                            </svg>
                                            üìö Documentation
                                        </a>
                                    </li>
                                    <li>
                                        <form method="post" action="{% url 'extranet:logout' %}" class="w-full">
                                            {% csrf_token %}
                                            <button type="submit" 
                                                    class="w-full text-left px-4 py-3 text-red-600 hover:bg-red-50 hover:text-red-800 transition-all duration-300 rounded-b-xl font-medium border-0 bg-transparent focus:outline-none focus:bg-red-50"
                                                    role="menuitem">
                                                <svg class="inline w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                                </svg>
                                                D√©connexion
                                            </button>
                                        </form>
                                    </li>
                                </ul>
                            </li>
                        {% else %}
                            <li>
                                <a href="{% url 'extranet:login' %}" 
                                   class="bg-secondary hover:bg-blue-500 text-white px-6 py-3 rounded-lg transition-all duration-300 shadow-lg hover:shadow-xl font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white focus:ring-opacity-50"
                                   role="menuitem">Connexion Extranet</a>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
                
                <!-- Bouton hamburger pour mobile am√©lior√© -->
                <button id="mobile-menu-btn" 
                        class="md:hidden flex flex-col items-center justify-center w-10 h-10 text-white bg-white/10 backdrop-blur-sm rounded-lg transition-all duration-300 hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50" 
                        aria-label="Ouvrir le menu" 
                        aria-expanded="false"
                        type="button">
                    <span class="hamburger-line block w-5 h-0.5 bg-white mb-1 transition-all duration-300 transform origin-center"></span>
                    <span class="hamburger-line block w-5 h-0.5 bg-white mb-1 transition-all duration-300"></span>
                    <span class="hamburger-line block w-5 h-0.5 bg-white transition-all duration-300 transform origin-center"></span>
                </button>
            </div>
            
            <!-- Menu mobile optimis√© -->
            <nav id="mobile-menu" 
                 class="md:hidden hidden mt-4 pb-4 transform transition-all duration-300 ease-in-out" 
                 aria-label="Menu mobile"
                 style="max-height: 0; opacity: 0; overflow: hidden;">
                <div class="bg-white/10 backdrop-blur-lg rounded-xl p-4 space-y-1 border border-white/20">
                    <a href="{% url 'extranet:home' %}" 
                       class="mobile-menu-item block px-4 py-3 text-white hover:bg-white/20 rounded-lg transition-all duration-200 font-medium flex items-center gap-3"
                       role="menuitem">
                        <span class="text-lg">üè†</span>
                        Dashboard
                    </a>
                    
                    {% if user.is_authenticated and user.is_superuser or user.is_authenticated and user.profile and user.profile.role == 'admin' %}
                    <div class="mobile-submenu">
                        <button class="mobile-submenu-btn w-full text-left px-4 py-3 text-white hover:bg-white/20 rounded-lg transition-all duration-200 font-medium flex justify-between items-center gap-3"
                                type="button"
                                aria-expanded="false">
                            <div class="flex items-center gap-3">
                                <span class="text-lg">üë®‚Äçüíº</span>
                                Admin
                            </div>
                            <svg class="w-4 h-4 mobile-chevron transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="mobile-submenu-content hidden pl-4 space-y-1 mt-1">
                            <a href="{% url 'extranet:user_admin' %}" 
                               class="block px-4 py-2 text-white/90 hover:bg-white/15 rounded-lg transition-all duration-200"
                               role="menuitem">Utilisateurs</a>
                            <a href="{% url 'extranet:admin_leaves' %}" 
                               class="block px-4 py-2 text-white/90 hover:bg-white/15 rounded-lg transition-all duration-200"
                               role="menuitem">Cong√©s (admin)</a>
                            <a href="{% url 'extranet:admin_teleworks' %}" 
                               class="block px-4 py-2 text-white/90 hover:bg-white/15 rounded-lg transition-all duration-200"
                               role="menuitem">T√©l√©travail (admin)</a>
                        </div>
                    </div>
                    {% endif %}
                    
                    <a href="{% url 'extranet:validation' %}" 
                       class="mobile-menu-item block px-4 py-3 text-white hover:bg-white/20 rounded-lg transition-all duration-200 font-medium flex items-center justify-between"
                       role="menuitem">
                        <div class="flex items-center gap-3">
                            <span class="text-lg">‚úÖ</span>
                            Validation
                        </div>
                        {% if user.is_authenticated and user.profile.role in 'manager rh admin' %}
                            {% if leave_validation_count or telework_validation_count %}
                                <span class="inline-flex items-center justify-center bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full min-w-[1.25rem]"
                                      aria-label="{{ leave_validation_count|add:telework_validation_count }} demandes en attente">
                                    {{ leave_validation_count|add:telework_validation_count }}
                                </span>
                            {% endif %}
                        {% endif %}
                    </a>
                    
                    <div class="mobile-submenu">
                        <button class="mobile-submenu-btn w-full text-left px-4 py-3 text-white hover:bg-white/20 rounded-lg transition-all duration-200 font-medium flex justify-between items-center gap-3"
                                type="button"
                                aria-expanded="false">
                            <div class="flex items-center gap-3">
                                <span class="text-lg">üèñÔ∏è</span>
                                Cong√©s
                                {% if user.is_authenticated and user.profile.role in 'manager rh admin' and leave_validation_count %}
                                    <span class="inline-flex items-center justify-center bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full min-w-[1.25rem]"
                                          aria-label="{{ leave_validation_count }} demandes de cong√©s en attente">
                                        {{ leave_validation_count }}
                                    </span>
                                {% endif %}
                            </div>
                            <svg class="w-4 h-4 mobile-chevron transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="mobile-submenu-content hidden pl-4 space-y-1 mt-1">
                            <a href="{% url 'extranet:new_leave_request' %}" 
                               class="block px-4 py-2 text-white/90 hover:bg-white/15 rounded-lg transition-all duration-200"
                               role="menuitem">Nouvelle demande</a>
                            <a href="{% url 'extranet:leave_list' %}" 
                               class="block px-4 py-2 text-white/90 hover:bg-white/15 rounded-lg transition-all duration-200"
                               role="menuitem">Mes demandes</a>
                            <a href="{% url 'extranet:monthly_leave_report' %}" 
                               class="block px-4 py-2 text-white/90 hover:bg-white/15 rounded-lg transition-all duration-200"
                               role="menuitem">Rapport mensuel</a>
                        </div>
                    </div>
                    
                    <div class="mobile-submenu">
                        <button class="mobile-submenu-btn w-full text-left px-4 py-3 text-white hover:bg-white/20 rounded-lg transition-all duration-200 font-medium flex justify-between items-center gap-3"
                                type="button"
                                aria-expanded="false">
                            <div class="flex items-center gap-3">
                                <span class="text-lg">üè†</span>
                                T√©l√©travail
                                {% if user.is_authenticated and user.profile.role in 'manager rh admin' and telework_validation_count %}
                                    <span class="inline-flex items-center justify-center bg-orange-500 text-white text-xs font-bold px-2 py-1 rounded-full min-w-[1.25rem]"
                                          aria-label="{{ telework_validation_count }} demandes de t√©l√©travail en attente">
                                        {{ telework_validation_count }}
                                    </span>
                                {% endif %}
                            </div>
                            <svg class="w-4 h-4 mobile-chevron transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="mobile-submenu-content hidden pl-4 space-y-1 mt-1">
                            <a href="{% url 'extranet:new_telework_request' %}" 
                               class="block px-4 py-2 text-white/90 hover:bg-white/15 rounded-lg transition-all duration-200"
                               role="menuitem">Nouvelle demande</a>
                            <a href="{% url 'extranet:telework_list' %}" 
                               class="block px-4 py-2 text-white/90 hover:bg-white/15 rounded-lg transition-all duration-200"
                               role="menuitem">Mes demandes</a>
                            <a href="{% url 'extranet:overtime_list' %}" 
                               class="block px-4 py-2 text-white/90 hover:bg-white/15 rounded-lg transition-all duration-200"
                               role="menuitem">‚è∞ Heures suppl√©mentaires</a>
                        </div>
                    </div>
                    
                    {% if user.is_authenticated and user.profile.site|lower == 'france' %}
                    <div class="mobile-submenu">
                        <button class="mobile-submenu-btn w-full text-left px-4 py-3 text-white hover:bg-white/20 rounded-lg transition-all duration-200 font-medium flex justify-between items-center gap-3"
                                type="button"
                                aria-expanded="false">
                            <div class="flex items-center gap-3">
                                <span class="text-lg">üè™</span>
                                Magasin
                            </div>
                            <svg class="w-4 h-4 mobile-chevron transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="mobile-submenu-content hidden pl-4 space-y-1 mt-1">
                            <a href="{% url 'extranet:stock' %}" 
                               class="block px-4 py-2 text-white/90 hover:bg-white/15 rounded-lg transition-all duration-200"
                               role="menuitem">Stock</a>
                            <a href="{% url 'extranet:entry_exit' %}" 
                               class="block px-4 py-2 text-white/90 hover:bg-white/15 rounded-lg transition-all duration-200"
                               role="menuitem">Entr√©e - Sortie</a>
                            <a href="{% url 'extranet:movements' %}" 
                               class="block px-4 py-2 text-white/90 hover:bg-white/15 rounded-lg transition-all duration-200"
                               role="menuitem">Mouvements</a>
                        </div>
                    </div>
                    {% endif %}
                    
                    <a href="{% url 'extranet:presence_calendar' %}" 
                       class="mobile-menu-item block px-4 py-3 text-white hover:bg-white/20 rounded-lg transition-all duration-200 font-medium flex items-center gap-3"
                       role="menuitem">
                        <span class="text-lg">üìÖ</span>
                        Calendrier
                    </a>
                    
                    {% if user.is_authenticated %}
                        <div class="mobile-submenu">
                            <button class="mobile-submenu-btn w-full text-left px-4 py-3 text-white hover:bg-white/20 rounded-lg transition-all duration-200 font-medium flex justify-between items-center gap-3"
                                    type="button"
                                    aria-expanded="false">
                                <div class="flex items-center gap-3">
                                    <span class="text-lg">üë§</span>
                                    {{ user.username }}
                                </div>
                                <svg class="w-4 h-4 mobile-chevron transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div class="mobile-submenu-content hidden pl-4 space-y-1 mt-1">
                                <a href="{% url 'extranet:account_settings' %}" 
                                   class="block px-4 py-2 text-white/90 hover:bg-white/15 rounded-lg transition-all duration-200 flex items-center gap-2"
                                   role="menuitem">
                                    <span class="text-sm">üë§</span>
                                    Mon profil
                                </a>
                                <a href="{% url 'extranet:document_list' %}" 
                                   class="block px-4 py-2 text-white/90 hover:bg-white/15 rounded-lg transition-all duration-200 flex items-center gap-2"
                                   role="menuitem">
                                    <span class="text-sm">üìö</span>
                                    Documentation
                                </a>
                                <form method="post" action="{% url 'extranet:logout' %}" class="w-full">
                                    {% csrf_token %}
                                    <button type="submit" 
                                            class="w-full text-left px-4 py-2 text-red-300 hover:bg-red-600/20 hover:text-red-200 rounded-lg transition-all duration-200 flex items-center gap-2 border-0 bg-transparent font-medium focus:outline-none focus:bg-red-600/20"
                                            role="menuitem">
                                        <span class="text-sm">üö™</span>
                                        D√©connexion
                                    </button>
                                </form>
                            </div>
                        </div>
                    {% else %}
                        <a href="{% url 'extranet:login' %}" 
                           class="mobile-menu-item block px-4 py-3 bg-secondary hover:bg-blue-500 text-white rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl font-medium text-center focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50"
                           role="menuitem">
                            üîê Connexion Extranet
                        </a>
                    {% endif %}
                </div>
            </nav>
        </div>
    </header>

    <main class="container mx-auto my-8 p-6 rounded-2xl shadow-2xl flex-grow animate-slide-up">
        {% if messages %}
            <div class="mb-6">
                {% for message in messages %}
                    <div class="p-4 rounded-xl shadow-lg mb-3 text-white font-semibold animate-fade-in
                        {% if 'success' in message.tags %} bg-gradient-to-r from-green-500 to-green-600
                        {% elif 'error' in message.tags %} bg-gradient-to-r from-red-500 to-red-600
                        {% elif 'info' in message.tags %} bg-gradient-to-r from-blue-500 to-blue-600
                        {% else %} bg-gradient-to-r from-primary to-secondary
                        {% endif %}">
                        <div class="flex items-center">
                            {% if 'success' in message.tags %}
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            {% elif 'error' in message.tags %}
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.966-.833-2.732 0L4.082 15.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                </svg>
                            {% else %}
                                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            {% endif %}
                            {{ message }}
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        {% block content %}{% endblock %}
    </main>

    <footer class="text-white py-6 mt-8 shadow-inner rounded-t-2xl">
        <div class="container mx-auto text-center">
            <div class="flex items-center justify-center space-x-2 mb-2">
                <img src="{% static 'img/logo_ictgroup.png' %}" alt="ICTGROUP" class="h-6 filter brightness-110">
                <span class="text-lg font-semibold">ICTGROUP</span>
            </div>
            <p class="text-sm opacity-90">&copy; {{ now|date:'Y' }} ICTGROUP. Tous droits r√©serv√©s. | Con√ßu avec passion pour l'excellence.</p>
        </div>
    </footer>
    {% block extra_js %}{% endblock %}
    <script src="{% static 'js/user_admin.js' %}"></script>
    
    <!-- Menu Mobile JavaScript Optimis√© -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üîç Initialisation du menu mobile...');
        
        // Variables du menu mobile
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        const hamburgerLines = document.querySelectorAll('.hamburger-line');
        const mobileSubmenuBtns = document.querySelectorAll('.mobile-submenu-btn');
        
        // Debug des √©l√©ments trouv√©s
        console.log('Mobile menu button:', mobileMenuBtn);
        console.log('Mobile menu:', mobileMenu);
        console.log('Hamburger lines:', hamburgerLines.length);
        console.log('Submenu buttons:', mobileSubmenuBtns.length);
        
        // Variables d'√©tat
        let isMobileMenuOpen = false;
        
        // Fonction pour basculer le menu mobile principal
        function toggleMobileMenu() {
            isMobileMenuOpen = !isMobileMenuOpen;
            
            if (isMobileMenuOpen) {
                // Ouvrir le menu
                mobileMenu.classList.remove('hidden');
                mobileMenu.style.maxHeight = mobileMenu.scrollHeight + 'px';
                mobileMenu.style.opacity = '1';
                
                // Animation du hamburger vers X
                hamburgerLines[0].style.transform = 'rotate(45deg) translateY(6px)';
                hamburgerLines[1].style.opacity = '0';
                hamburgerLines[2].style.transform = 'rotate(-45deg) translateY(-6px)';
                
                // Mettre √† jour aria-expanded
                mobileMenuBtn.setAttribute('aria-expanded', 'true');
                mobileMenuBtn.setAttribute('aria-label', 'Fermer le menu');
                
                console.log('‚úÖ Menu mobile ouvert');
            } else {
                // Fermer le menu
                mobileMenu.style.maxHeight = '0';
                mobileMenu.style.opacity = '0';
                
                // Animation du X vers hamburger
                hamburgerLines[0].style.transform = 'rotate(0) translateY(0)';
                hamburgerLines[1].style.opacity = '1';
                hamburgerLines[2].style.transform = 'rotate(0) translateY(0)';
                
                // Mettre √† jour aria-expanded
                mobileMenuBtn.setAttribute('aria-expanded', 'false');
                mobileMenuBtn.setAttribute('aria-label', 'Ouvrir le menu');
                
                // Fermer tous les sous-menus
                mobileSubmenuBtns.forEach(btn => {
                    const content = btn.nextElementSibling;
                    const chevron = btn.querySelector('.mobile-chevron');
                    if (content && content.classList.contains('mobile-submenu-content')) {
                        content.classList.add('hidden');
                        btn.setAttribute('aria-expanded', 'false');
                        if (chevron) {
                            chevron.style.transform = 'rotate(0deg)';
                        }
                    }
                });
                
                // Masquer apr√®s l'animation
                setTimeout(() => {
                    if (!isMobileMenuOpen) {
                        mobileMenu.classList.add('hidden');
                    }
                }, 300);
                
                console.log('‚ùå Menu mobile ferm√©');
            }
        }
        
        // Event listener pour le bouton hamburger
        if (mobileMenuBtn && mobileMenu) {
            mobileMenuBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                toggleMobileMenu();
            });
        } else {
            console.error('‚ùå √âl√©ments du menu mobile manquants');
        }
        
        // Gestion des sous-menus mobiles
        mobileSubmenuBtns.forEach(function(btn) {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const content = this.nextElementSibling;
                const chevron = this.querySelector('.mobile-chevron');
                const isOpen = !content.classList.contains('hidden');
                
                // Fermer tous les autres sous-menus
                mobileSubmenuBtns.forEach(otherBtn => {
                    if (otherBtn !== this) {
                        const otherContent = otherBtn.nextElementSibling;
                        const otherChevron = otherBtn.querySelector('.mobile-chevron');
                        if (otherContent && otherContent.classList.contains('mobile-submenu-content')) {
                            otherContent.classList.add('hidden');
                            otherBtn.setAttribute('aria-expanded', 'false');
                            if (otherChevron) {
                                otherChevron.style.transform = 'rotate(0deg)';
                            }
                        }
                    }
                });
                
                // Basculer le sous-menu actuel
                if (isOpen) {
                    content.classList.add('hidden');
                    this.setAttribute('aria-expanded', 'false');
                    if (chevron) {
                        chevron.style.transform = 'rotate(0deg)';
                    }
                } else {
                    content.classList.remove('hidden');
                    this.setAttribute('aria-expanded', 'true');
                    if (chevron) {
                        chevron.style.transform = 'rotate(180deg)';
                    }
                }
                
                console.log(`üîÑ Sous-menu ${isOpen ? 'ferm√©' : 'ouvert'}`);
            });
        });
        
        // Fermer le menu mobile lors du clic sur un lien
        const mobileMenuLinks = document.querySelectorAll('#mobile-menu a:not(.mobile-submenu-btn)');
        mobileMenuLinks.forEach(function(link) {
            link.addEventListener('click', function() {
                if (isMobileMenuOpen) {
                    toggleMobileMenu();
                }
            });
        });
        
        // Fermer le menu mobile si on clique en dehors
        document.addEventListener('click', function(e) {
            if (isMobileMenuOpen && !mobileMenuBtn.contains(e.target) && !mobileMenu.contains(e.target)) {
                toggleMobileMenu();
            }
        });
        
        // Gestion du redimensionnement de la fen√™tre
        window.addEventListener('resize', function() {
            if (window.innerWidth >= 768 && isMobileMenuOpen) {
                // Fermer le menu mobile si on passe en mode desktop
                toggleMobileMenu();
            }
        });
        
        // Gestion du focus pour l'accessibilit√©
        if (mobileMenuBtn) {
            mobileMenuBtn.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    toggleMobileMenu();
                }
            });
        }
        
        // Am√©lioration des dropdowns desktop pour la fiabilit√© des clics
        const desktopDropdowns = document.querySelectorAll('nav[aria-label="Menu principal"] .group');
        desktopDropdowns.forEach(function(dropdown) {
            const trigger = dropdown.querySelector('a[role="button"]');
            const menu = dropdown.querySelector('ul[role="menu"]');
            
            if (trigger && menu) {
                let timeout;
                
                // Am√©liorer la visibilit√© du menu au hover
                dropdown.addEventListener('mouseenter', function() {
                    if (window.innerWidth >= 768) {
                        clearTimeout(timeout);
                        menu.style.visibility = 'visible';
                        menu.style.opacity = '1';
                        menu.style.transform = 'translateY(0)';
                    }
                });
                
                dropdown.addEventListener('mouseleave', function() {
                    if (window.innerWidth >= 768) {
                        timeout = setTimeout(() => {
                            menu.style.visibility = 'hidden';
                            menu.style.opacity = '0';
                            menu.style.transform = 'translateY(8px)';
                        }, 150);
                    }
                });
                
                // Gestion du focus pour l'accessibilit√©
                trigger.addEventListener('focus', function() {
                    if (window.innerWidth >= 768) {
                        clearTimeout(timeout);
                        menu.style.visibility = 'visible';
                        menu.style.opacity = '1';
                        menu.style.transform = 'translateY(0)';
                    }
                });
                
                trigger.addEventListener('blur', function() {
                    if (window.innerWidth >= 768) {
                        timeout = setTimeout(() => {
                            if (!menu.matches(':hover') && !menu.contains(document.activeElement)) {
                                menu.style.visibility = 'hidden';
                                menu.style.opacity = '0';
                                menu.style.transform = 'translateY(8px)';
                            }
                        }, 150);
                    }
                });
            }
        });
        
        console.log('‚úÖ Menu mobile initialis√© avec succ√®s');
    });
    </script>
    
    <!-- Performance optimizations script -->
    <script>
        // Optimize performance and interactivity
        (function() {
            'use strict';
            
            // Lazy load non-critical CSS
            function loadNonCriticalCSS() {
                const style = document.getElementById('non-critical-styles');
                if (style) {
                    style.media = 'all';
                }
            }
            
            // Load after page interaction or 3 seconds
            const events = ['keydown', 'mousemove', 'touchstart'];
            events.forEach(event => {
                document.addEventListener(event, function loadCSS() {
                    loadNonCriticalCSS();
                    events.forEach(e => document.removeEventListener(e, loadCSS));
                }, { passive: true });
            });
            
            setTimeout(loadNonCriticalCSS, 3000);
            
            // Enhanced accessibility
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Tab') {
                    document.body.classList.add('keyboard-navigation');
                }
            });
            
            document.addEventListener('mousedown', function() {
                document.body.classList.remove('keyboard-navigation');
            });
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('nav[aria-label="Menu principal"]')) {
                    const dropdowns = document.querySelectorAll('nav[aria-label="Menu principal"] .relative.group ul');
                    dropdowns.forEach(function(dropdown) {
                        dropdown.style.display = 'none';
                    });
                }
            });
            
        })();
    </script>
    
    <!-- Add keyboard navigation styles -->
    <style>
        .keyboard-navigation *:focus {
            outline: 2px solid #0090FF !important;
            outline-offset: 2px !important;
        }
    </style>
</body>
</html>