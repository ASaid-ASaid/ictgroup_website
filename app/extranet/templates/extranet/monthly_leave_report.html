{% extends 'extranet/base.html' %}
{% load extranet_filters %}
{% load math_filters %}
{% block title %}üìä Rapport Mensuel des Cong√©s - ICTGROUP{% endblock %}

{% block content %}
<main role="main" class="container mx-auto px-4 py-6">
    <div class="bg-gradient-to-r from-primary/10 to-secondary/10 rounded-2xl p-6 mb-6">
        <h1 class="text-3xl font-extrabold text-primary mb-4 text-center tracking-tight flex items-center justify-center gap-3">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2-2V7a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 002 2h6a2 2 0 002-2V7a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 00-2 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2z"></path>
            </svg>
            üìä Rapport Mensuel des Cong√©s
        </h1>
        <p class="text-gray-600 text-center mb-4">
            Analyse compl√®te des cong√©s, t√©l√©travail et pr√©sence mensuelle de l'√©quipe
        </p>
        
        <!-- Statistiques globales -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-6">
            <div class="bg-white rounded-lg p-4 shadow-md border-l-4 border-blue-500">
                <div class="flex items-center">
                    <div class="text-blue-500 text-2xl">üë•</div>
                    <div class="ml-3">
                        <p class="text-sm text-gray-600">Total Collaborateurs</p>
                        <p class="text-xl font-bold text-gray-900">{{ users|length }}</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg p-4 shadow-md border-l-4 border-green-500">
                <div class="flex items-center">
                    <div class="text-green-500 text-2xl">üèñÔ∏è</div>
                    <div class="ml-3">
                        <p class="text-sm text-gray-600">Jours de Cong√©s</p>
                        <p class="text-xl font-bold text-gray-900">{{ total_leave_days|floatformat:0 }}</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg p-4 shadow-md border-l-4 border-orange-500">
                <div class="flex items-center">
                    <div class="text-orange-500 text-2xl">üè†</div>
                    <div class="ml-3">
                        <p class="text-sm text-gray-600">Jours T√©l√©travail</p>
                        <p class="text-xl font-bold text-gray-900">{{ total_telework_days|floatformat:0 }}</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg p-4 shadow-md border-l-4 border-purple-500">
                <div class="flex items-center">
                    <div class="text-purple-500 text-2xl">‚è∞</div>
                    <div class="ml-3">
                        <p class="text-sm text-gray-600">Heures Suppl√©mentaires</p>
                        <p class="text-xl font-bold text-gray-900">{{ total_overtime_hours|floatformat:0 }}h</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Filtres -->
    <section class="bg-gradient-to-r from-primary/5 to-secondary/5 p-6 rounded-xl shadow-sm mb-6">
        <h2 class="text-lg font-bold text-primary mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.707A1 1 0 013 7V4z"></path>
            </svg>
            Filtres
        </h2>
        <form method="get" class="flex flex-wrap items-end gap-4">
            <div class="form-group">
                <label for="month" class="block text-sm font-medium text-gray-700 mb-2">Mois</label>
                <select id="month" name="month" class="p-3 border border-gray-300 rounded-lg focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200">
                    {% for m in month_range %}
                        {% with m_str=m|stringformat:'02d' %}
                        <option value="{{ m_str }}" {% if selected_month|slice:'5:' == m_str %}selected{% endif %}>
                            {% if m == 1 %}Janvier{% elif m == 2 %}F√©vrier{% elif m == 3 %}Mars{% elif m == 4 %}Avril{% elif m == 5 %}Mai{% elif m == 6 %}Juin{% elif m == 7 %}Juillet{% elif m == 8 %}Ao√ªt{% elif m == 9 %}Septembre{% elif m == 10 %}Octobre{% elif m == 11 %}Novembre{% elif m == 12 %}D√©cembre{% endif %}
                        </option>
                        {% endwith %}
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label for="year" class="block text-sm font-medium text-gray-700 mb-2">Ann√©e</label>
                <select id="year" name="year" class="p-3 border border-gray-300 rounded-lg focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200">
                    {% for y in year_range %}
                        <option value="{{ y }}" {% if year == y %}selected{% endif %}>{{ y }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label for="site" class="block text-sm font-medium text-gray-700 mb-2">Site</label>
                <select id="site" name="site" class="p-3 border border-gray-300 rounded-lg focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200">
                    <option value="">Tous les sites</option>
                    {% for site in available_sites %}
                        <option value="{{ site }}" {% if selected_site == site %}selected{% endif %}>
                            {% if site == 'tunisie' %}üáπüá≥ Tunisie{% elif site == 'france' %}üá´üá∑ France{% else %}{{ site|capfirst }}{% endif %}
                        </option>
                    {% endfor %}
                </select>
            </div>
            
            <button type="submit" 
                    class="px-6 py-3 bg-gradient-to-r from-primary to-secondary text-white font-medium rounded-lg hover:shadow-lg transition-all duration-200 focus:ring-2 focus:ring-primary focus:ring-offset-2">
                <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                Filtrer
            </button>
            
            <!-- Bouton Export CSV -->
            <button type="button" 
                    onclick="exportToCSV()" 
                    class="px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white font-medium rounded-lg hover:shadow-lg transition-all duration-200 focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
                <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                üìÑ Export CSV
            </button>
        </form>
    </section>

    <!-- Tableau des donn√©es -->
    <section class="bg-white rounded-xl shadow-lg overflow-hidden">
        <div class="p-4 bg-gradient-to-r from-gray-50 to-gray-100 border-b">
            <div class="flex justify-between items-center">
                <h3 class="text-lg font-semibold text-gray-800">
                    üìÖ P√©riode : {{ selected_month|date:"F Y" }}
                </h3>
                <div class="flex items-center gap-2 text-sm text-gray-600">
                    <span class="flex items-center gap-1">
                        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                        Excellent (>10j)
                    </span>
                    <span class="flex items-center gap-1">
                        <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                        Attention (5-10j)
                    </span>
                    <span class="flex items-center gap-1">
                        <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                        Critique (<5j)
                    </span>
                </div>
            </div>
        </div>
        <div class="overflow-x-auto">
            <table id="reportTable" class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gradient-to-r from-primary to-secondary text-white">
                    <tr>
                        <th class="px-6 py-4 text-left text-xs font-medium uppercase tracking-wider cursor-pointer hover:bg-black/10" onclick="sortTable(0)">
                            Collaborateur 
                            <svg class="w-3 h-3 inline ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                            </svg>
                        </th>
                        <th class="px-6 py-4 text-left text-xs font-medium uppercase tracking-wider">Site</th>
                        <th class="px-6 py-4 text-center text-xs font-medium uppercase tracking-wider cursor-pointer hover:bg-black/10" onclick="sortTable(2)">
                            üèñÔ∏è Cong√©s (j)
                            <svg class="w-3 h-3 inline ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                            </svg>
                        </th>
                        <th class="px-6 py-4 text-center text-xs font-medium uppercase tracking-wider cursor-pointer hover:bg-black/10" onclick="sortTable(3)">
                            üè† T√©l√©travail (j)
                            <svg class="w-3 h-3 inline ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                            </svg>
                        </th>
                        <th class="px-6 py-4 text-center text-xs font-medium uppercase tracking-wider cursor-pointer hover:bg-black/10" onclick="sortTable(4)">
                            üè¢ Bureau (j)
                            <svg class="w-3 h-3 inline ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                            </svg>
                        </th>
                        <th class="px-6 py-4 text-center text-xs font-medium uppercase tracking-wider cursor-pointer hover:bg-black/10" onclick="sortTable(5)">
                            ‚è∞ H. Sup. (h)
                            <svg class="w-3 h-3 inline ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                            </svg>
                        </th>
                        <th class="px-6 py-4 text-center text-xs font-medium uppercase tracking-wider cursor-pointer hover:bg-black/10" onclick="sortTable(6)">
                            üíº Solde Cong√©s
                            <svg class="w-3 h-3 inline ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                            </svg>
                        </th>
                        <th class="px-6 py-4 text-center text-xs font-medium uppercase tracking-wider">
                            üìà Performance
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for user in users %}
                    <tr class="hover:bg-gray-50 transition-colors duration-200">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-10 w-10">
                                    <div class="h-10 w-10 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-white font-semibold text-sm">
                                        {{ user.first_name.0|default:user.username.0|upper }}{{ user.last_name.0|default:""|upper }}
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">
                                        {{ user.get_full_name|default:user.username }}
                                    </div>
                                    <div class="text-sm text-gray-500">@{{ user.username }}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                {% if user.profile.site == 'tunisie' %}bg-red-100 text-red-800{% else %}bg-blue-100 text-blue-800{% endif %}">
                                {% if user.profile.site == 'tunisie' %}üáπüá≥ Tunisie{% elif user.profile.site == 'france' %}üá´üá∑ France{% else %}{{ user.profile.site|capfirst }}{% endif %}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <div class="flex items-center justify-center">
                                <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold
                                    {% if user.days_leave > 5 %}bg-red-100 text-red-800 border border-red-200{% elif user.days_leave > 2 %}bg-yellow-100 text-yellow-800 border border-yellow-200{% else %}bg-green-100 text-green-800 border border-green-200{% endif %}">
                                    {{ user.days_leave|floatformat:1 }}
                                    {% if user.days_leave > 5 %}üî•{% elif user.days_leave > 2 %}‚ö†Ô∏è{% else %}‚úÖ{% endif %}
                                </span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <div class="flex items-center justify-center">
                                <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold
                                    {% if user.days_telework > 10 %}bg-orange-100 text-orange-800 border border-orange-200{% elif user.days_telework > 5 %}bg-blue-100 text-blue-800 border border-blue-200{% else %}bg-gray-100 text-gray-800 border border-gray-200{% endif %}">
                                    {{ user.days_telework }}
                                    {% if user.days_telework > 10 %}üè†{% elif user.days_telework > 5 %}üì±{% else %}üíº{% endif %}
                                </span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <div class="flex items-center justify-center">
                                <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold
                                    {% if user.days_at_office > 15 %}bg-green-100 text-green-800 border border-green-200{% elif user.days_at_office > 10 %}bg-blue-100 text-blue-800 border border-blue-200{% else %}bg-yellow-100 text-yellow-800 border border-yellow-200{% endif %}">
                                    {{ user.days_at_office }}
                                    {% if user.days_at_office > 15 %}üè¢{% elif user.days_at_office > 10 %}üë•{% else %}‚ö†Ô∏è{% endif %}
                                </span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <div class="flex items-center justify-center">
                                <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold
                                    {% if user.overtime_hours > 20 %}bg-red-100 text-red-800 border border-red-200{% elif user.overtime_hours > 10 %}bg-yellow-100 text-yellow-800 border border-yellow-200{% elif user.overtime_hours > 0 %}bg-blue-100 text-blue-800 border border-blue-200{% else %}bg-gray-100 text-gray-800 border border-gray-200{% endif %}">
                                    {{ user.overtime_hours|floatformat:1 }}h
                                    {% if user.overtime_hours > 20 %}üíÄ{% elif user.overtime_hours > 10 %}‚è∞{% elif user.overtime_hours > 0 %}üí™{% else %}üò¥{% endif %}
                                </span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <div class="flex items-center justify-center">
                                <span class="inline-flex items-center px-3 py-1.5 rounded-full text-sm font-bold border-2
                                    {% if user.leave_balance_remaining > 10 %}bg-green-50 text-green-700 border-green-300{% elif user.leave_balance_remaining > 5 %}bg-yellow-50 text-yellow-700 border-yellow-300{% else %}bg-red-50 text-red-700 border-red-300{% endif %}">
                                    {{ user.leave_balance_remaining|floatformat:1 }}j
                                    {% if user.leave_balance_remaining > 10 %}üåü{% elif user.leave_balance_remaining > 5 %}‚ö†Ô∏è{% else %}üö®{% endif %}
                                </span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <div class="flex items-center justify-center">
                                {% with total_days=user.days_leave|add:user.days_telework|add:user.days_at_office %}
                                {% with performance_ratio=user.days_at_office|mul:100|div:total_days %}
                                <div class="w-16 h-16 relative">
                                    <svg class="w-16 h-16 transform -rotate-90" viewBox="0 0 36 36">
                                        <path class="text-gray-300" stroke="currentColor" stroke-width="3" fill="none" d="M18 2.0845a 15.9155 15.9155 0 0 1 0 31.831a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                        <path class="{% if performance_ratio > 70 %}text-green-500{% elif performance_ratio > 50 %}text-yellow-500{% else %}text-red-500{% endif %}" 
                                              stroke="currentColor" stroke-width="3" fill="none" 
                                              stroke-dasharray="{{ performance_ratio }}, 100"
                                              d="M18 2.0845a 15.9155 15.9155 0 0 1 0 31.831a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                    </svg>
                                    <div class="absolute inset-0 flex items-center justify-center">
                                        <span class="text-xs font-bold {% if performance_ratio > 70 %}text-green-600{% elif performance_ratio > 50 %}text-yellow-600{% else %}text-red-600{% endif %}">
                                            {{ performance_ratio|floatformat:0 }}%
                                        </span>
                                    </div>
                                </div>
                                {% endwith %}
                                {% endwith %}
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="8" class="px-6 py-8 text-center text-gray-500">
                            <div class="flex flex-col items-center">
                                <svg class="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2M4 13h2m13-8V4a1 1 0 00-1-1H7a1 1 0 00-1 1v1m8 0V4.5M9 5v-.5"></path>
                                </svg>
                                <h3 class="text-lg font-medium text-gray-900 mb-2">Aucune donn√©e disponible</h3>
                                <p>Aucun collaborateur trouv√© pour cette p√©riode</p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>

    <!-- Actions -->
    <div class="mt-6 flex flex-wrap justify-center gap-4">
        <a href="{% url 'extranet:leave_list' %}" 
           class="px-6 py-3 bg-gray-100 text-gray-700 font-medium rounded-lg hover:bg-gray-200 transition-all duration-200 focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
            Retour aux demandes
        </a>
        
        <button onclick="printReport()" 
                class="px-6 py-3 bg-blue-500 text-white font-medium rounded-lg hover:bg-blue-600 transition-all duration-200 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
            </svg>
            üñ®Ô∏è Imprimer
        </button>
        
        <button onclick="location.reload()" 
                class="px-6 py-3 bg-green-500 text-white font-medium rounded-lg hover:bg-green-600 transition-all duration-200 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
            üîÑ Actualiser
        </button>
    </div>
</main>

<script>
// Fonction d'export CSV
function exportToCSV() {
    const table = document.getElementById('reportTable');
    const rows = table.querySelectorAll('tr');
    let csv = [];
    
    // En-t√™tes
    const headers = Array.from(rows[0].querySelectorAll('th')).map(th => {
        return th.textContent.replace(/\s+/g, ' ').trim().replace(/[üìäüèñÔ∏èüè†üè¢‚è∞üíºüìà]/g, '');
    });
    csv.push(headers.join(','));
    
    // Donn√©es
    for (let i = 1; i < rows.length; i++) {
        const row = rows[i];
        if (row.cells.length > 1) { // Skip empty rows
            const cells = Array.from(row.cells).map(cell => {
                // Clean cell content (remove emojis and extra whitespace)
                let text = cell.textContent.replace(/\s+/g, ' ').trim();
                text = text.replace(/[üáπüá≥üá´üá∑‚úÖ‚ö†Ô∏èüö®üî•üè†üì±üíºüåüüíÄüò¥üí™]/g, '');
                return `"${text}"`;
            });
            csv.push(cells.join(','));
        }
    }
    
    // T√©l√©charger le fichier
    const csvContent = csv.join('\n');
    const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', `rapport_mensuel_conges_${new Date().toISOString().slice(0, 7)}.csv`);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

// Fonction de tri des colonnes
function sortTable(columnIndex) {
    const table = document.getElementById('reportTable');
    const tbody = table.tBodies[0];
    const rows = Array.from(tbody.rows);
    
    const isNumeric = columnIndex >= 2; // Les colonnes 2+ sont num√©riques
    
    rows.sort((a, b) => {
        const aVal = a.cells[columnIndex].textContent.trim();
        const bVal = b.cells[columnIndex].textContent.trim();
        
        if (isNumeric) {
            const aNum = parseFloat(aVal.replace(/[^\d.-]/g, '')) || 0;
            const bNum = parseFloat(bVal.replace(/[^\d.-]/g, '')) || 0;
            return bNum - aNum; // Tri d√©croissant
        } else {
            return aVal.localeCompare(bVal);
        }
    });
    
    // R√©appliquer les lignes tri√©es
    rows.forEach(row => tbody.appendChild(row));
}

// Fonction d'impression
function printReport() {
    const printContent = document.querySelector('main').cloneNode(true);
    
    // Supprimer les boutons d'action pour l'impression
    const actionButtons = printContent.querySelector('.mt-6');
    if (actionButtons) actionButtons.remove();
    
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <html>
        <head>
            <title>Rapport Mensuel des Cong√©s</title>
            <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                th { background-color: #f2f2f2; font-weight: bold; }
                .text-center { text-align: center; }
                .bg-gradient-to-r { background: linear-gradient(to right, #3b82f6, #8b5cf6); }
                .text-white { color: white; }
                @media print {
                    body { margin: 0; }
                    .no-print { display: none; }
                }
            </style>
        </head>
        <body>
            ${printContent.innerHTML}
        </body>
        </html>
    `);
    printWindow.document.close();
    printWindow.print();
}
</script>
{% endblock %}
